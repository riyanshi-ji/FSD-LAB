<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STUDENT MANAGEMENT</title>
</head>

<body>
    <center>
        <h2>Smart Student Manager</h2>
        <input id="Name" type="text" placeholder="Enter Name"><br><br>
        <input id="Email" type="text" placeholder="Enter Email"><br><br>
        <input id="Marks" type="number" placeholder="Enter Marks"><br><br>
        <button onclick="addStudent()">Add Student</button><br><br>
        <button onclick="removeStudent()">Remove Student</button><br><br>
        <h3>Student List:-</h3>
        <ul id="studentList"></ul>
    </center>

    <script>
        let students = [];                   // Array
        let emailSet = new Set();            // Set (unique emails)
        let gradeMap = new Map();            // Map (email -> grade )

        function addStudent() {
            try {
                debugger;

                const name = document.getElementById("Name").value;
                const email = document.getElementById("Email").value;
                const marks = Number(document.getElementById("Marks").value);

                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

                if (!emailPattern.test(email)) {
                    throw new Error("Invalid Email Format");
                }

                if (marks < 0 || marks > 100) {
                    throw new Error("Marks must be between 0 and 100");
                }

                if (emailSet.has(email)) {
                    throw new Error("Email already Exist");
                }

                emailSet.add(email);

                // OBJECT 

                const student = {
                    name,
                    email,
                    marks,
                    date: new Date(),
                    getGrade: function () {
                        return calculateGrade(this.marks);
                    }
                };

                students.push(student);

                gradeMap.set(email, student.getGrade());

                displayStudents();
                clearFields();

            } catch (error) {
                alert(error.message);
            }
        }

        function calculateGrade(marks) {
            if (marks >= 90) return "A";
            if (marks >= 75) return "B";
            if (marks >= 60) return "C";
            if (marks >= 40) return "D";
            return "Fail";
        }

        function displayStudents() {
            const list = document.getElementById("studentList");
            list.innerHTML = "";

            // Iteration (forEach)
            students.forEach((student) => {

                // Destructuring
                const { name, email, marks, date } = student;

                const li = document.createElement("li");
                li.textContent = `
Name: ${name},
Email: ${email},
Marks: ${marks},
Grade: ${gradeMap.get(email)},
Added On: ${date.toLocaleDateString()}
                `;

                list.appendChild(li);
            });

            calculateAverage();
        }

        function calculateAverage() {
            if (students.length === 0) return;

            let total = 0;

            for (let student of students) {   // for...of iteration
                total += student.marks;
            }

            const average = Math.round(total / students.length);

            console.log("Class Average:", average);
        }

        // ================= CLEAR INPUT =================

        function clearFields() {
            document.getElementById("Name").value = "";
            document.getElementById("Email").value = "";
            document.getElementById("Marks").value = "";
        }

        //----------------Remove Student ------------------
        function removeStudent() {
    const email = document.getElementById("Email").value;

    if (!emailSet.has(email)) {
        alert("Student not found!");
        return;
    }

    students = students.filter(student => student.email !== email);

    emailSet.delete(email);
    gradeMap.delete(email);

    displayStudents();
    clearFields();

    alert("Student removed successfully!");
}

    </script>
</body>

</html>
